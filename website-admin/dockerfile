# --- Stage 1: Build the React Application ---
# Use an official Node.js image specifically for building the frontend
FROM node:18-alpine as builder

# Set the working directory inside this build container
WORKDIR /app

# Copy package.json and package-lock.json first to leverage Docker cache
COPY package*.json ./

# Install frontend dependencies
RUN npm install

# Copy the entire React application source code
COPY . .

# Build the React application for production
# This command generates optimized static files (HTML, CSS, JS)
# It typically puts them in a 'build' folder.
RUN npm run build

# --- Stage 2: Serve the Built Application with Nginx ---
# Use a lightweight Nginx image for serving static files
FROM nginx:alpine

# Copy the built React app from the 'builder' stage
# The 'build' folder's contents are copied to Nginx's default web server directory
COPY --from=builder /app/build /usr/share/nginx/html

# Optional: You can uncomment and modify this line if you have a custom Nginx configuration file
# For most React apps, the default Nginx config works fine for serving static files.
# COPY nginx.conf /etc/nginx/conf.d/default.conf

# Expose the standard HTTP port 80, as Nginx will listen on this port internally
EXPOSE 80

# Command to start Nginx in the foreground
# 'daemon off;' is important so Nginx stays in the foreground, allowing Docker to manage its lifecycle
CMD ["nginx", "-g", "daemon off;"]